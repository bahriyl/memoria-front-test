<!DOCTYPE html>
<html lang="uk">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Memoria — Профіль</title>

    <link rel="stylesheet" href="css/premium_qr_person.css">
    <link rel="stylesheet" href="css/profile.css">
</head>

<body>
    <main class="profile-container">
        <header class="profile-hero">
            <!-- ← back arrow -->
            <a href="index.html" class="back-button" data-nav="back" aria-label="Повернутися">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round">
                    <polyline points="15 18 9 12 15 6"></polyline>
                </svg>
            </a>

            <div class="profile-avatar-wrapper">
                <img class="profile-avatar" src="" alt="Фото особи" />
                <div class="avatar-spinner" id="avatar-spinner"></div>

                <div id="avatar-menu" class="avatar-menu" hidden>
                    <div class="avatar-menu-card">
                        <button id="avatar-add" class="avatar-menu-item">Додати фото</button>
                        <button id="avatar-change" class="avatar-menu-item">Змінити фото</button>
                        <button id="hero-change" class="avatar-menu-item">Змінити фон</button>
                        <button id="avatar-delete" class="avatar-menu-item">Видалити фото</button>
                    </div>
                </div>
            </div>
        </header>

        <section class="profile-info">
            <h1 class="profile-name"></h1>
            <p class="profile-years"></p>
            <p class="profile-cemetery"></p>
            <a id="location-btn" href="#" class="location-button">
                <svg class="location-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 14 16" width="14" height="16"
                    fill="none">
                    <path
                        d="M13 6.83333C13 10.8328 8.2 15 7 15C5.8 15 1 10.8328 1 6.83333C1 3.61167 3.68629 1 7 1C10.3137 1 13 3.61167 13 6.83333Z"
                        stroke="white" stroke-width="1.6" />
                    <circle cx="2" cy="2" r="2" transform="matrix(-1 0 0 1 9 5)" fill="white" stroke="white"
                        stroke-width="0.8" />
                </svg>

                <span id="action-btn">Локація місця поховання</span>
            </a>
        </section>

        <!-- Biography section -->
        <section class="profile-bio">
            <div class="bio-header">
                <h2 class="bio-title">Життєпис</h2>
                <button id="bio-menu-btn" class="dots-btn" aria-label="Дії">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#585858" viewBox="0 0 24 24">
                        <circle cx="12" cy="5" r="2"></circle>
                        <circle cx="12" cy="12" r="2"></circle>
                        <circle cx="12" cy="19" r="2"></circle>
                    </svg>
                </button>
                <div id="bio-menu" class="popup-menu">
                    <div id="bio-edit-option" class="popup-option">Змінити</div>
                </div>

                <div class="bio-buttons">
                    <button class="btn bio-edit-btn" id="bio-edit">Змінити</button>
                    <button class="btn bio-edit-btn" id="bio-add" style="display:none;">Додати</button>
                </div>
            </div>

            <div class="bio-body">
                <p class="bio-content collapsed" id="bio-content">
                    <!-- JS will inject fullBio text here... -->
                </p>
            </div>
        </section>

        <!-- Shared Album (Cпільний альбом) -->
        <section class="profile-shared">
            <h2 class="shared-title">Cпільний альбом</h2>

            <!-- 3-dots menu -->
            <button id="shared-menu-btn" class="dots-btn" aria-label="Дії">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#585858" viewBox="0 0 24 24">
                    <circle cx="12" cy="5" r="2"></circle>
                    <circle cx="12" cy="12" r="2"></circle>
                    <circle cx="12" cy="19" r="2"></circle>
                </svg>
            </button>
            <div id="shared-menu" class="popup-menu">
                <div id="shared-add-option" class="popup-option">Добавити</div>
                <div id="shared-choose-option" class="popup-option">Вибрати</div>
            </div>

            <!-- Інлайнових кнопок для “Вибрати” немає; все через dots -->
            <div class="shared-controls">
                <button id="shared-add-btn" class="btn photo-btn">Добавити</button>
                <button id="shared-delete-btn" class="btn photo-btn">Видалити</button>
                <input type="file" id="shared-input" accept="image/*" multiple hidden />
            </div>

            <div class="shared-scroll">
                <ul class="photos-list shared-list"></ul>
            </div>
        </section>

        <!-- Photographs section -->
        <section class="profile-photos">
            <h2 class="photos-title">Фотографії</h2>
            <button id="photos-menu-btn" class="dots-btn" aria-label="Дії">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#585858" viewBox="0 0 24 24">
                    <circle cx="12" cy="5" r="2"></circle>
                    <circle cx="12" cy="12" r="2"></circle>
                    <circle cx="12" cy="19" r="2"></circle>
                </svg>
            </button>
            <div id="photos-menu" class="popup-menu">
                <div id="photos-add-option" class="popup-option">Добавити</div>
                <div id="photos-choose-option" class="popup-option">Вибрати</div>
            </div>

            <div class="photos-controls">
                <button id="add-photo-btn" class="btn photo-btn">Додати</button>
                <button id="choose-photo-btn" class="btn photo-btn">Вибрати</button>
                <button id="delete-photo-btn" class="btn photo-btn">Видалити</button>

                <!-- Hidden file input instead of modal -->
                <input type="file" id="photo-input" accept="image/*" multiple hidden />
            </div>
            <div class="photos-scroll">
                <ul class="photos-list"></ul>
            </div>
        </section>

        <section class="profile-liturgy">
            <h2 class="liturgy-title">Електронна записка за упокій</h2>

            <!-- Date Selection -->
            <div class="liturgy-date">
                <div class="date-header">
                    <span class="date-label">Оберіть дату</span>
                    <span class="selected-date"></span>
                </div>
                <div class="date-calendar">
                    <!-- Dates will be generated dynamically by JavaScript -->
                </div>
            </div>

            <!-- Church Selection -->
            <div class="liturgy-church">
                <span class="church-label">Оберіть церкву</span>
                <div class="church-options">
                    <button class="church-btn">Собор Св. Юра</button>
                    <button class="church-btn">Собор Петра і Павла</button>
                </div>
            </div>

            <!-- Service Details -->
            <div class="liturgy-details">
                <div class="person-name"></div>
                <div class="service-info"></div>
            </div>

            <!-- Donation Amount -->
            <div class="liturgy-donation">
                <span class="donation-label">Оберіть суму пожертви</span>
                <div class="donation-options">
                    <button class="donation-btn">50 грн</button>
                    <button class="donation-btn">100 грн</button>
                    <button class="donation-btn">200 грн</button>
                    <button class="donation-btn">Інше</button>
                </div>
            </div>

            <!-- Submit Button -->
            <button class="liturgy-submit">Надіслати записку в церкву</button>
        </section>

        <!-- Comments Section -->
        <section class="profile-comments">
            <h2 class="comments-title">Коментарі</h2>

            <div class="comments-list">
                <!-- Comments will be populated by JavaScript -->
            </div>

            <!-- Add Comment Form -->
            <div class="add-comment">
                <h3 class="add-comment-title">Додати коментар</h3>
                <div class="comment-templates">
                    <button class="template-btn">Щирі співчуття</button>
                    <button class="template-btn">Вічна пам'ять та слава герою</button>
                    <button class="template-btn">Співчуття рідним та близьким</button>
                    <button class="template-btn">Добавте локацію</button>
                </div>
            </div>
        </section>

        <!-- Relatives Section -->
        <section class="profile-relatives">
            <h2 class="relatives-title">Родичі</h2>
            <button id="rel-menu-btn" class="dots-btn" aria-label="Дії">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#585858" viewBox="0 0 24 24">
                    <circle cx="12" cy="5" r="2"></circle>
                    <circle cx="12" cy="12" r="2"></circle>
                    <circle cx="12" cy="19" r="2"></circle>
                </svg>
            </button>
            <div id="rel-menu" class="popup-menu">
                <div id="rel-add-option" class="popup-option">Добавити</div>
                <div id="rel-choose-option" class="popup-option">Вибрати</div>
            </div>

            <div class="relatives-controls">
                <button class="btn relatives-btn" id="add-relative-btn">Добавити</button>
                <button class="btn relatives-btn" id="choose-relative-btn">Вибрати</button>
                <button class="btn relatives-btn" id="rel-cancel-btn" style="display:none;">Скасувати</button>
                <button class="btn relatives-btn" id="rel-delete-btn" style="display:none;">Видалити</button>
            </div>

            <div class="relatives-list">
                <!-- Relatives will be populated by JavaScript -->
            </div>
        </section>

        <!-- Success toast (reused from add_person) -->
        <div id="toast" class="toast toast--success" hidden>
            <span id="toast-text">Успішно відправлено на модерацію! Ми сповістимо вас коли буде готово</span>
            <button id="toast-close" class="toast-close" type="button" aria-label="Закрити">&times;</button>
        </div>

        <!-- Avatar cropper -->
        <div id="avatar-cropper-overlay" class="avatar-cropper-overlay" hidden></div>
        <div id="avatar-cropper" class="avatar-cropper" hidden role="dialog" aria-modal="true"
            aria-labelledby="avatar-cropper-title">
            <div class="avatar-cropper-header">
                <h3 id="avatar-cropper-title">Розмістіть фото</h3>
                <p class="avatar-cropper-subtitle">Пересуньте та змініть масштаб так, щоб обличчя було всередині кола
                </p>
            </div>

            <div class="avatar-cropper-stage" id="avatar-cropper-stage">
                <img id="avatar-cropper-img" alt="">
                <!-- circular mask on top -->
                <div class="avatar-cropper-mask"></div>
            </div>

            <div class="avatar-cropper-controls">
                <div class="avatar-cropper-buttons">
                    <button id="avatar-cropper-cancel" type="button" class="btn">Скасувати</button>
                    <button id="avatar-cropper-ok" type="button" class="btn primary">Зберегти</button>
                </div>
            </div>
        </div>

        <!-- Hero change overlay (dims the page, but hero stays visible above it) -->
        <div id="hero-overlay" class="hero-change-overlay" hidden></div>

        <!-- Hero picker -->
        <div id="hero-picker" class="hero-picker" hidden role="dialog" aria-modal="true"
            aria-labelledby="hero-picker-title">
            <div class="hero-picker-card">
                <!-- thumbnails go here -->
                <div id="hero-grid" class="hero-grid"></div>

                <div class="hero-actions">
                    <button id="hero-cancel" type="button" class="btn">Скасувати</button>
                    <button id="hero-apply" type="button" class="btn primary" disabled>Встановити</button>
                </div>
            </div>
        </div>

    </main>

    <!-- Confirm Delete Photos (profile) -->
    <div id="modal-overlay" class="modal-overlay" hidden></div>
    <div id="confirm-delete-modal" class="modal" hidden>
        <button id="confirm-delete-close" class="modal-close" aria-label="Закрити"><svg viewBox="0 0 30 30" width="28"
                height="28" aria-hidden="true">
                <path d="M7 7l10 10M17 7L7 17" stroke="#90959C" stroke-width="2" stroke-linecap="round"></path>
            </svg></button>
        <p id="confirm-delete-modal-text" class="modal-text">Видалити вибрані фотографії?</p>
        <div class="modal-actions">
            <button id="confirm-delete-cancel" class="modal-cancel">Скасувати</button>
            <button id="confirm-delete-ok" class="modal-ok">Видалити</button>
        </div>
    </div>

    <!-- Comment Template → Ask for User Name -->
    <div id="comment-template-modal" class="modal" hidden>
        <button id="confirm-close" class="modal-close" aria-label="Закрити"><svg viewBox="0 0 30 30" width="28"
                height="28" aria-hidden="true">
                <path d="M7 7l10 10M17 7L7 17" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
            </svg></button>
        <p class="modal-text">Вкажіть ваше ім’я</p>
        <input id="comment-user-input" type="text" placeholder="Введіть Імʼя...">
        <div class="modal-actions">
            <button id="comment-template-cancel" class="modal-cancel">Скасувати</button>
            <button id="comment-template-ok" class="modal-ok">Підтвердити</button>
        </div>
    </div>

    <!-- Premium header -->
    <div class="ritual-header" id="profile-login-header" hidden>
        <button class="ritual-login-btn" id="profile-login-btn">Увійти</button>
    </div>

    <!-- Same modal markup as ritual_service_profile -->
    <div class="login-modal" id="loginModal">
        <div class="login-box">
            <button id="loginClose" class="login-close" aria-label="Закрити"><svg viewBox="0 0 30 30" width="28"
                    height="28" aria-hidden="true">
                    <path d="M7 7l10 10M17 7L7 17" stroke="#90959C" stroke-width="2" stroke-linecap="round"></path>
                </svg></button>
            <h2>Авторизація</h2>
            <input type="text" id="loginInput" placeholder="Логін" />
            <input type="password" id="passwordInput" placeholder="Пароль" />
            <p id="forgotPassword" class="forgot-password">Забули або змінити пароль</p>
            <button id="loginSubmit">Увійти</button>
            <p id="loginError" class="error-message"></p>
        </div>
    </div>

    <!-- Add descriptions for selected photos -->
    <div id="photo-desc-modal" class="modal" hidden>
        <button id="photo-desc-close" class="modal-close" aria-label="Закрити"><svg viewBox="0 0 30 30" width="28"
                height="28" aria-hidden="true">
                <path d="M7 7l10 10M17 7L7 17" stroke="#90959C" stroke-width="2" stroke-linecap="round"></path>
            </svg></button>

        <h3 class="modal-title">
            Додати фото (<span id="photo-desc-count">0</span>)
        </h3>

        <div class="photo-desc-thumbs" id="photo-desc-thumbs"></div>

        <textarea id="photo-desc-text" class="photo-desc-textarea" placeholder="Додати опис..."></textarea>

        <div class="modal-actions">
            <button id="photo-desc-add" class="modal-ok">Додати</button>
        </div>
    </div>

    <!-- Custom Donation Modal -->
    <div id="donation-modal" class="modal" hidden>
        <button id="donation-close" class="modal-close" aria-label="Закрити">&times;</button>
        <p class="modal-text">Введіть суму пожертви (грн)</p>
        <input id="donation-input" type="number" min="1" step="1" placeholder="Сума, грн"
            style="width:100%;box-sizing:border-box;background:#F1F3F5;border:none;border-radius:8px;padding:10px 12px;font-size:15px;outline:none;">
        <div class="modal-actions">
            <button id="donation-cancel" class="modal-cancel">Скасувати</button>
            <button id="donation-ok" class="modal-ok">Підтвердити</button>
        </div>
    </div>

    <!-- Add Relative (modal) -->
    <div id="relativesModal" class="modal-overlay" hidden>
        <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="relModalTitle">
            <button class="modal-close" id="relModalClose" type="button" aria-label="Закрити">×</button>
            <h2 class="modal-title" id="relModalTitle" style="text-align:center;margin:6px 0 30px">Додати родича</h2>

            <!-- 1) ПІБ -->
            <div class="form-group">
                <input type="text" id="relName" placeholder="Введіть ПІБ…" autocomplete="off" />
                <div id="relNameError" class="error-message" hidden></div>
            </div>

            <!-- 2) Роки життя (пілюля з панеллю вибору) -->
            <div class="form-group">
                <div class="year-pill" id="relYearsPill">
                    <div class="year-display" id="relYearsDisplay">Рік народження та смерті</div>

                    <button type="button" id="relClearYears" class="icon-btn clear-btn" aria-label="Очистити" hidden>
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round">
                            <line x1="18" y1="6" x2="6" y2="18" />
                            <line x1="6" y1="6" x2="18" y2="18" />
                        </svg>
                    </button>

                    <div class="years-panel" id="relYearsPanel" hidden>
                        <h3 class="years-panel__title">Рік народження та смерті</h3>
                        <div class="years-body">
                            <div class="year-column">
                                <div class="year-wheel year-wheel--flat">
                                    <ul class="year-list" id="relBirthYears"></ul>
                                    <div class="year-focus" aria-hidden="true"></div>
                                </div>
                            </div>
                            <div class="year-column">
                                <div class="year-wheel year-wheel--flat">
                                    <ul class="year-list" id="relDeathYears"></ul>
                                    <div class="year-focus" aria-hidden="true"></div>
                                </div>
                            </div>
                        </div>
                        <button type="button" class="done-btn" id="relYearsDone">Готово</button>
                    </div>
                </div>
            </div>
            <input type="hidden" id="relBirthYear">
            <input type="hidden" id="relDeathYear">

            <!-- 3) Населений пункт -->
            <div class="form-group">
                <div class="suggestions-container">
                    <input type="text" id="relArea" placeholder="Введіть населений пункт…" autocomplete="off" />
                    <button class="icon-btn clear-btn" id="relAreaClear" aria-label="Очистити">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round">
                            <line x1="18" y1="6" x2="6" y2="18" />
                            <line x1="6" y1="6" x2="18" y2="18" />
                        </svg>
                    </button>
                    <ul class="suggestions-list" id="relAreaSuggestions"></ul>
                </div>
            </div>

            <!-- 4) Кладовище -->
            <div class="form-group suggestions-container">
                <input type="text" id="relCemetery" placeholder="Введіть назву кладовища…" autocomplete="off" />
                <button class="icon-btn clear-btn" id="relCemClear" aria-label="Очистити">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18" />
                        <line x1="6" y1="6" x2="18" y2="18" />
                    </svg>
                </button>
                <ul class="suggestions-list" id="relCemeterySuggestions"></ul>
            </div>


            <!-- Обрані / Знайдені -->
            <div class="modal-subtitle" style="text-align:left">Вибрано (<span id="relSelectedCount">0</span>) :</div>
            <ul id="relSelectedList" class="people-list"></ul>

            <div class="modal-subtitle" style="text-align:left">Знайдено (<span id="relFoundCount">0</span>) :</div>
            <ul id="relFoundList" class="people-list" tabindex="0"></ul>

            <!-- Submit -->
            <button id="relSubmit" class="modal-submit-btn" style="margin-top:14px">Додати родича</button>
        </div>
    </div>

    <script src="js/year_wheel.js"></script>
    <script src="js/profile.js"></script>
</body>

</html>